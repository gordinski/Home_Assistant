![–ì–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω](../img/ha_roe_outages_dashboard.png)

# –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –†—ñ–≤–Ω–µ–æ–±–ª–µ–Ω–µ—Ä–≥–æ –≤ Home Assistant

–î–∞–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–π –±–ª–æ–∫ –Ω–∞ –¥–∞—à–±–æ—Ä–¥—ñ, —è–∫–∏–π –ø–æ—î–¥–Ω—É—î —Ç–µ–∫—Å—Ç–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å —Ç–∞ —ó—Ö –≤—ñ–∑—É–∞–ª—å–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —É –≤–∏–≥–ª—è–¥—ñ —á–∞—Å–æ–≤–æ—ó —à–∫–∞–ª–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —Ç–∞ –∑–∞–≤—Ç—Ä–∞.

## üõ† –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

–î–ª—è —Ä–æ–±–æ—Ç–∏ —Ü—å–æ–≥–æ –±–ª–æ–∫—É —É –≤–∞—Å –º–∞—é—Ç—å –±—É—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–∞—Å—Ç–æ–º–Ω—ñ –∫–∞—Ä—Ç–∫–∏ (—á–µ—Ä–µ–∑ HACS):

1.  [**Layout Card**](https://github.com/thomasloven/lovelace-layout-card) (–¥–ª—è –≥–Ω—É—á–∫–æ—ó —Å—ñ—Ç–∫–∏).
2.  [**ApexCharts Card**](https://github.com/RomRider/apexcharts-card) (–¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤).

## üìä –û–ø–∏—Å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–∞

–ë–ª–æ–∫ —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏–π –Ω–∞ –¥–≤—ñ —á–∞—Å—Ç–∏–Ω–∏:

- **–õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ (Markdown):** –í–∏–≤–æ–¥–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ —É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ, —è–∫–∏–π –ø—ñ–¥—Ç—è–≥—É—î—Ç—å—Å—è –∑ —Å–µ–Ω—Å–æ—Ä–∞.
- **–ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ (Charts):** –î–≤–∞ –≥—Ä–∞—Ñ—ñ–∫–∏, —è–∫—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å, –¥–µ "—Å—å–æ–≥–æ–¥–Ω—ñ", –∞ –¥–µ "–∑–∞–≤—Ç—Ä–∞", –∞–Ω–∞–ª—ñ–∑—É—é—á–∏ –¥–∞—Ç–∏ –∑ —Å–µ–Ω—Å–æ—Ä—ñ–≤ `roe_date_row5` —Ç–∞ `roe_date_row6`.

## üìù –ö–æ–¥ –¥–ª—è Dashboard (YAML)

–î–æ–¥–∞—î–º–æ –Ω–æ–≤—É —Å–µ–∫—Ü—ñ—é —ñ —Ä–µ–¥–∞–≥—É—î–º–æ —É —Ñ–æ—Ä–º–∞—Ç—ñ yaml:

```yaml
type: custom:layout-card
layout_type: grid
layout:
  grid-template-columns: 1fr 2fr
  grid-gap: 8px
  mediaquery:
    "(max-width: 800px)":
      grid-template-columns: 1fr
cards:
  - type: markdown
    content: |
      {{ state_attr('sensor.roe_telegram_message', 'formatted_text') }}
    title: ‚ö° –ì—Ä–∞—Ñ—ñ–∫ –†—ñ–≤–Ω–µ–æ–±–ª–µ–Ω–µ—Ä–≥–æ (6.2)
    text_only: true
  - type: vertical-stack
    cards:
      - type: custom:apexcharts-card
        header:
          show: true
          title: –°—å–æ–≥–æ–¥–Ω—ñ
          show_states: false
        graph_span: 24h
        span:
          start: day
        now:
          show: true
          label: –ó–∞—Ä–∞–∑
        series:
          - entity: sensor.roe_raw_row5
            type: area
            curve: stepline
            stroke_width: 0
            data_generator: >
              const today = new Date().toLocaleDateString('uk-UA');

              const s5d = hass.states['sensor.roe_date_row5'].state;

              const s6d = hass.states['sensor.roe_date_row6'].state;

              const str = (s5d === today) ?
              hass.states['sensor.roe_raw_row5'].state : (s6d === today ?
              hass.states['sensor.roe_raw_row6'].state : '');


              const outages = new Set();

              const regex = /(\d{1,2}):\d{2}\s*[-‚Äì‚Äî]\s*(\d{1,2}):\d{2}/g;

              let m;

              while ((m = regex.exec(str)) !== null) {
                let start = parseInt(m[1]), end = parseInt(m[2]) || 24;
                for (let i = start; i < end; i++) outages.add(i);
              }

              const startOfDay = new Date().setHours(0, 0, 0, 0);

              return Array.from({length: 25}, (_, i) => [new
              Date(startOfDay).setHours(i), outages.has(i === 24 ? 23 : i) ? 0 :
              1]);
        apex_config:
          chart:
            height: 130
          fill:
            type: solid
            opacity: 1
          xaxis:
            type: datetime
            labels:
              show: true
              format: HH
            tickAmount: 24
          yaxis:
            show: false
            min: 0
            max: 4
          grid:
            show: false
          tooltip:
            enabled: false
            x:
              format: HH:00
      - type: custom:apexcharts-card
        header:
          show: true
          title: –ó–∞–≤—Ç—Ä–∞
          show_states: false
        graph_span: 24h
        span:
          start: day
          offset: +24h
        series:
          - entity: sensor.roe_raw_row6
            type: area
            curve: stepline
            stroke_width: 0
            data_generator: >
              const tomorrowDate = new Date();

              tomorrowDate.setDate(tomorrowDate.getDate() + 1);

              const tomorrowStr = tomorrowDate.toLocaleDateString('uk-UA');


              const s5d = hass.states['sensor.roe_date_row5'].state;

              const s6d = hass.states['sensor.roe_date_row6'].state;

              const str = (s5d === tomorrowStr) ?
              hass.states['sensor.roe_raw_row5'].state : (s6d === tomorrowStr ?
              hass.states['sensor.roe_raw_row6'].state : '');


              const outages = new Set();

              const regex = /(\d{1,2}):\d{2}\s*[-‚Äì‚Äî]\s*(\d{1,2}):\d{2}/g;

              let m;

              while ((m = regex.exec(str)) !== null) {
                let start = parseInt(m[1]), end = parseInt(m[2]) || 24;
                for (let i = start; i < end; i++) outages.add(i);
              }

              // –í–∞–∂–ª–∏–≤–æ: –¥–ª—è –∑–∞–≤—Ç—Ä–∞—à–Ω—å–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞ –∑–º—ñ—â—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Ç–æ—á–∫—É –Ω–∞
              +24 –≥–æ–¥–∏–Ω–∏

              const startOfTomorrow = new Date().setHours(0, 0, 0, 0) +
              86400000;

              return Array.from({length: 25}, (_, i) => [startOfTomorrow + (i *
              3600000), outages.has(i === 24 ? 23 : i) ? 0 : 1]);
        apex_config:
          chart:
            height: 130
          fill:
            type: solid
            opacity: 1
          xaxis:
            type: datetime
            labels:
              show: true
              format: HH
            tickAmount: 24
          yaxis:
            show: false
            min: 0
            max: 4
          grid:
            show: false
          tooltip:
            enabled: false
            x:
              format: HH:00
column_span: 4
```

## –õ–æ–≥—ñ–∫–∞ data_generator

–°–∫—Ä–∏–ø—Ç —É –∫–∞—Ä—Ç–∫–∞—Ö –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥—ñ—ó:

- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—Ç–∏:** –û—Ç—Ä–∏–º—É—î –ø–æ—Ç–æ—á–Ω—É —Å–∏—Å—Ç–µ–º–Ω—É –¥–∞—Ç—É —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—é—î —ó—ó –∑ –¥–∞—Ç–∞–º–∏ –≤ sensor.roe_date_row5 —Ç–∞ sensor.roe_date_row6.

- **–ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç—É:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –¥–ª—è –ø–æ—à—É–∫—É —á–∞—Å–æ–≤–∏—Ö –ø—Ä–æ–º—ñ–∂–∫—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 14:00 - 19:00) —É "—Å–∏—Ä–æ–º—É" —Ä—è–¥–∫—É –≤—ñ–¥ –æ–±–ª–µ–Ω–µ—Ä–≥–æ.

- **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –º–∞—Å–∏–≤—É:** –°—Ç–≤–æ—Ä—é—î –º–∞—Å–∏–≤ —Ç–æ—á–æ–∫ –¥–ª—è –∫–æ–∂–Ω–æ—ó –≥–æ–¥–∏–Ω–∏ –¥–æ–±–∏. –Ø–∫—â–æ –≥–æ–¥–∏–Ω–∞ –≤—Ö–æ–¥–∏—Ç—å —É –¥—ñ–∞–ø–∞–∑–æ–Ω –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ‚Äî –ø—Ä–∏—Å–≤–æ—é—î—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è 0, —è–∫—â–æ –Ω—ñ ‚Äî 1.

- **–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è:** stepline –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ü—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏.
